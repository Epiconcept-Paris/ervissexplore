---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# ervissexplore

<!-- badges: start -->
[![R-CMD-check](https://github.com/Epiconcept-Paris/ervissexplore/actions/workflows/formatting_and_check.yml/badge.svg)](https://github.com/Epiconcept-Paris/ervissexplore/actions/)
<!-- badges: end -->

An R package to easily retrieve ERVISS (European Respiratory Virus Surveillance Summary) data from the EU-ECDC. Provides functions to fetch, filter, and optionally visualize respiratory virus surveillance data across European countries.

Please visit https://erviss.org/ for a detailed description of the underlying data (see 'Methods' in the footer).

## Installation

```{r, eval=FALSE}
install.packages("pak")
pak::pak("Epiconcept-Paris/ervissexplore")
```

## Quick Start

```{r}
library(ervissexplore)

# Retrieve SARS-CoV-2 positivity data
positivity_data <- get_sentineltests_positivity(
  date_min = as.Date("2024-01-01"),
  date_max = as.Date("2024-12-31"),
  pathogen = "SARS-CoV-2",
  countries = c("France", "Germany", "Italy")
)

head(positivity_data)
```

## Data Sources

The package fetches data directly from the [EU-ECDC Respiratory Viruses Weekly Data](https://github.com/EU-ECDC/Respiratory_viruses_weekly_data) repository.

Seven data sources are available:

| Data source | Function | Description |
|-------------|----------|-------------|
| Sentinel positivity | `get_sentineltests_positivity()` | Test positivity rates by pathogen |
| SARS-CoV-2 variants | `get_erviss_variants()` | Variant proportions and detections |
| ILI/ARI rates | `get_ili_ari_rates()` | ILI/ARI consultation rates by age group |
| SARI rates | `get_sari_rates()` | SARI hospitalisation rates by age group |
| SARI virological | `get_sari_positivity()` | SARI tests, detections and positivity |
| Non-sentinel severity | `get_nonsentinel_severity()` | Deaths, hospital and ICU admissions |
| Non-sentinel tests | `get_nonsentinel_tests()` | Non-sentinel tests and detections |

A generic function `get_erviss_data(type = ...)` can also be used to access
any of the above sources.

### Latest Data vs Snapshots

By default, functions fetch the latest available data. For reproducibility,
you can use historical snapshots:

```{r, eval=FALSE}
# Use a specific snapshot for reproducible analyses
data <- get_sentineltests_positivity(
  date_min = as.Date("2023-01-01"),
  date_max = as.Date("2023-12-31"),
  use_snapshot = TRUE,
  snapshot_date = as.Date("2024-02-23")
)
```

To see available snapshot dates, visit the [EU-ECDC Respiratory Viruses Weekly Data repository](https://github.com/EU-ECDC/Respiratory_viruses_weekly_data/tree/main/data/snapshots).

** Please be aware that data are subject to retrospective update at any time.**


## Examples

### Retrieve and analyze data

```{r}
# Get positivity data (returns a data.table)
data <- get_sentineltests_positivity(
  date_min = as.Date("2024-01-01"),
  date_max = as.Date("2024-06-30"),
  pathogen = c("SARS-CoV-2", "Influenza"),
  countries = c("France", "Spain", "Italy"),
  indicator = "positivity"
)

# Your own analysis with data.table syntax
data[,
  .(
    min_positivity = min(value, na.rm = TRUE),
    mean_positivity = mean(value, na.rm = TRUE),
    max_positivity = max(value, na.rm = TRUE)
  ),
  by = .(countryname, pathogen)
]
```

### Other data sources

```{r, eval=FALSE}
# ILI consultation rates
ili_data <- get_ili_ari_rates(
  date_min = as.Date("2024-01-01"),
  date_max = as.Date("2024-12-31"),
  indicator = "ILIconsultationrate",
  age = c("0-4", "65+"),
  countries = "France"
)

# Hospital admissions
severity_data <- get_nonsentinel_severity(
  date_min = as.Date("2024-01-01"),
  date_max = as.Date("2024-12-31"),
  pathogen = "SARS-CoV-2",
  indicator = "hospitaladmissions",
  countries = c("France", "Spain")
)

# SARI positivity
sari_data <- get_sari_positivity(
  date_min = as.Date("2024-01-01"),
  date_max = as.Date("2024-12-31"),
  pathogen = "Influenza",
  indicator = "positivity",
  countries = "EU/EEA"
)
```

### Using the generic function

```{r, eval=FALSE}
# All sources accessible via a single function
data <- get_erviss_data(
  type = "nonsentinel_severity",
  date_min = as.Date("2024-01-01"),
  date_max = as.Date("2024-12-31"),
  pathogen = "SARS-CoV-2",
  indicator = "hospitaladmissions"
)
```

### Visualization (optional)

The package includes optional plotting functions for quick exploration.
They return `ggplot2` objects that can be customized freely:

```{r}
data <- get_sentineltests_positivity(
  date_min = as.Date("2024-01-01"),
  date_max = as.Date("2024-06-30"),
  pathogen = "SARS-CoV-2",
  countries = c("France", "Spain"),
  indicator = "positivity"
)
plot_erviss_positivity(data, date_breaks = "1 month")
```

Or use the quick one-liners:

```{r, eval=FALSE}
quick_plot_ili_ari_rates(
  date_min = as.Date("2024-01-01"),
  date_max = as.Date("2024-12-31"),
  indicator = "ILIconsultationrate",
  countries = c("France", "Spain"),
  date_breaks = "1 month"
)
```

### Using a local CSV file

```{r, eval=FALSE}
# If you have downloaded the data locally
data <- get_erviss_variants(
  csv_file = "path/to/local/variants.csv",
  date_min = as.Date("2024-01-01"),
  date_max = as.Date("2024-12-31")
)
```

## Main Functions

### Data retrieval

| Function | Description |
|----------|-------------|
| `get_sentineltests_positivity()` | Sentinel test positivity rates |
| `get_erviss_variants()` | SARS-CoV-2 variant data |
| `get_ili_ari_rates()` | ILI/ARI consultation rates |
| `get_sari_rates()` | SARI hospitalisation rates |
| `get_sari_positivity()` | SARI virological data |
| `get_nonsentinel_severity()` | Non-sentinel severity data |
| `get_nonsentinel_tests()` | Non-sentinel tests/detections |
| `get_erviss_data()` | Generic function (all types) |

### Visualization (optional)

| Function | Description |
|----------|-------------|
| `plot_erviss_positivity()` | Plot positivity data |
| `plot_erviss_variants()` | Plot variant data |
| `plot_ili_ari_rates()` | Plot ILI/ARI rates |
| `plot_sari_rates()` | Plot SARI rates |
| `plot_sari_positivity()` | Plot SARI virological data |
| `plot_nonsentinel_severity()` | Plot severity data |
| `plot_nonsentinel_tests()` | Plot non-sentinel tests |
| `plot_erviss_data()` | Generic plot function |
| `quick_plot_*()` | Fetch + plot in one call |

### URL builders

| Function | Description |
|----------|-------------|
| `get_erviss_url()` | Generic URL builder (all types) |
| `get_sentineltests_positivity_url()` | Positivity data URL |
| `get_erviss_variants_url()` | Variants data URL |
| `get_ili_ari_rates_url()` | ILI/ARI rates URL |
| `get_sari_rates_url()` | SARI rates URL |
| `get_sari_positivity_url()` | SARI virological data URL |
| `get_nonsentinel_severity_url()` | Non-sentinel severity URL |
| `get_nonsentinel_tests_url()` | Non-sentinel tests URL |


## Acknowledgments

We gratefully acknowledge the input of national public health and laboratory staff involved in surveillance activities and submission of surveillance data to The European Surveillance System (TESSy).

We also gratefully acknowledge the originating and submitting laboratories for SARS-CoV-2 sequence data in GISAID EpiCoVTM. A complete table acknowledging all originating and submitting laboratories can be downloaded from the [ECDC website](https://www.ecdc.europa.eu/en/publications-data/gisaid-acknowledgements).

## Citation

European Centre for Disease Prevention and Control. European Respiratory Virus Surveillance Summary (ERVISS), 2026, Week 05. Available at https://erviss.org/.

## Contributing to `{ervissexplore}`

New contributors are welcome !

You can contribute to the package in many ways:

- By reporting bugs, issues or feature requests: please open an issue on
  the [GitHub
  repository](https://github.com/Epiconcept-Paris/ervissexplore/issues).
- By fixing bugs or improving the package: please clone or fork the
  repository, work on a dedicated branch and create a pull request.
